# ğŸ› DEBUGæ¨¡å¼è®­ç»ƒä½¿ç”¨æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

è¿™ä¸ªå¢å¼ºçš„è®­ç»ƒè„šæœ¬æä¾›äº†å…¨é¢çš„DEBUGåŠŸèƒ½ï¼Œå¯ä»¥ä¿å­˜è®­ç»ƒè¿‡ç¨‹ä¸­çš„æ‰€æœ‰æ•°æ®ï¼Œå¸®åŠ©æ‚¨è¯¦ç»†åˆ†ææ¨¡å‹çš„è®­ç»ƒçŠ¶æ€å’Œæ€§èƒ½ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯åŠ¨è®­ç»ƒï¼ˆDEBUGæ¨¡å¼ï¼‰
```bash
cd /home/qhy/Research/LLM/GRPO-Clean-2
./run_model_parallel_only.sh
```

### 2. å®æ—¶ç›‘æ§è®­ç»ƒçŠ¶æ€
åœ¨å¦ä¸€ä¸ªç»ˆç«¯ä¸­è¿è¡Œï¼š
```bash
cd /home/qhy/Research/LLM/GRPO-Clean-2
./monitor_training.sh
```

### 3. åˆ†æDEBUGæ•°æ®
è®­ç»ƒå®Œæˆåæˆ–è®­ç»ƒè¿‡ç¨‹ä¸­ï¼š
```bash
cd /home/qhy/Research/LLM/GRPO-Clean-2
python analyze_debug_data.py
```

## ğŸ“ DEBUGæ•°æ®ç›®å½•ç»“æ„

è®­ç»ƒå¯åŠ¨åï¼Œä¼šåœ¨ `./model_parallel_only_outputs/debug_data/` ä¸‹åˆ›å»ºä»¥ä¸‹ç›®å½•ç»“æ„ï¼š

```
debug_data/
â”œâ”€â”€ generations/
â”‚   â””â”€â”€ 20241216-213045/          # æ—¶é—´æˆ³ç›®å½•
â”‚       â”œâ”€â”€ step_001_generations.json
â”‚       â”œâ”€â”€ step_005_generations.json
â”‚       â””â”€â”€ ...
â”œâ”€â”€ failed_generations/
â”‚   â””â”€â”€ 20241216-213045/
â”‚       â”œâ”€â”€ step_001_failed.json
â”‚       â””â”€â”€ ...
â”œâ”€â”€ successful_generations/
â”‚   â””â”€â”€ 20241216-213045/
â”‚       â”œâ”€â”€ step_001_success.json
â”‚       â””â”€â”€ ...
â”œâ”€â”€ detailed_metrics/
â”‚   â””â”€â”€ 20241216-213045/
â”‚       â”œâ”€â”€ step_001_metrics.json
â”‚       â””â”€â”€ ...
â”œâ”€â”€ model_outputs/
â”‚   â””â”€â”€ 20241216-213045/
â”‚       â”œâ”€â”€ step_001_outputs.json
â”‚       â””â”€â”€ ...
â”œâ”€â”€ reward_details/
â”‚   â””â”€â”€ 20241216-213045/
â”‚       â”œâ”€â”€ step_001_rewards.json
â”‚       â””â”€â”€ ...
â””â”€â”€ training_logs/
    â””â”€â”€ 20241216-213045/
        â”œâ”€â”€ full_training_log.txt      # å®Œæ•´è®­ç»ƒæ—¥å¿—
        â”œâ”€â”€ error_log.txt              # é”™è¯¯æ—¥å¿—
        â”œâ”€â”€ gpu_monitor.log            # GPUç›‘æ§æ—¥å¿—
        â”œâ”€â”€ final_gpu_status.csv       # æœ€ç»ˆGPUçŠ¶æ€
        â””â”€â”€ training_summary.txt       # è®­ç»ƒæ‘˜è¦
```

## ğŸ”§ DEBUGé…ç½®å‚æ•°

### ä¸»è¦DEBUGå‚æ•°
| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `DEBUG_MODE` | `true` | å¯ç”¨è¯¦ç»†debugæ¨¡å¼ |
| `SAVE_ALL_GENERATIONS` | `true` | ä¿å­˜æ‰€æœ‰ç”Ÿæˆçš„æ ·æœ¬ |
| `SAVE_FAILED_GENERATIONS` | `true` | ä¿å­˜å¤±è´¥çš„ç”Ÿæˆæ ·æœ¬ |
| `SAVE_SUCCESSFUL_GENERATIONS` | `true` | ä¿å­˜æˆåŠŸçš„ç”Ÿæˆæ ·æœ¬ |
| `SAVE_DETAILED_METRICS` | `true` | ä¿å­˜è¯¦ç»†çš„è®­ç»ƒæŒ‡æ ‡ |
| `SAVE_MODEL_OUTPUTS` | `true` | ä¿å­˜æ¨¡å‹çš„åŸå§‹è¾“å‡º |
| `SAVE_REWARD_DETAILS` | `true` | ä¿å­˜å¥–åŠ±è®¡ç®—çš„è¯¦ç»†ä¿¡æ¯ |
| `DEBUG_SAMPLE_FREQUENCY` | `5` | æ¯5æ­¥ä¿å­˜ä¸€æ¬¡è¯¦ç»†æ ·æœ¬ |
| `LOGGING_STEPS` | `1` | æ¯æ­¥éƒ½è®°å½•æ—¥å¿— |

### WandBå¢å¼ºé…ç½®
- **é¡¹ç›®æ ‡ç­¾**: `debug,model_parallel,lora,grpo,verilog`
- **è¿è¡Œåç§°**: `DEBUG-model-parallel-LR2e-5-R64-BS2x8-20241216-213045`
- **ä¿å­˜ä»£ç **: âœ… è‡ªåŠ¨ä¿å­˜è®­ç»ƒä»£ç 
- **ä¿å­˜æ¨¡å‹**: âœ… è‡ªåŠ¨ä¿å­˜æ¨¡å‹æ£€æŸ¥ç‚¹
- **ç›‘æ§å‚æ•°**: âœ… ç›‘æ§æ‰€æœ‰æ¨¡å‹å‚æ•°

## ğŸ“Š å®æ—¶ç›‘æ§åŠŸèƒ½

### å¯åŠ¨ç›‘æ§
```bash
./monitor_training.sh
```

### ç›‘æ§é€‰é¡¹
```bash
./monitor_training.sh --debug_dir /path/to/debug/data --interval 30
```

### ç›‘æ§å†…å®¹
- âœ… **è®­ç»ƒè¿›ç¨‹çŠ¶æ€**: æ£€æŸ¥è®­ç»ƒæ˜¯å¦æ­£åœ¨è¿è¡Œ
- ğŸ“Š **GPUä½¿ç”¨æƒ…å†µ**: å†…å­˜ã€åˆ©ç”¨ç‡ã€æ¸©åº¦
- ğŸ› **DEBUGæ•°æ®ç»Ÿè®¡**: å„ç±»æ–‡ä»¶æ•°é‡å’Œæœ€æ–°æ–‡ä»¶æ—¶é—´
- ğŸ“„ **å®æ—¶æ—¥å¿—**: æ˜¾ç¤ºæœ€æ–°çš„è®­ç»ƒæ—¥å¿—
- ğŸ’¾ **ç£ç›˜ä½¿ç”¨**: ç›‘æ§å­˜å‚¨ç©ºé—´ä½¿ç”¨æƒ…å†µ

## ğŸ” æ•°æ®åˆ†æåŠŸèƒ½

### åŸºæœ¬åˆ†æ
```bash
python analyze_debug_data.py
```

### æŒ‡å®šç›®å½•åˆ†æ
```bash
python analyze_debug_data.py --debug_dir /path/to/debug/data
```

### åˆ†æå†…å®¹
- ğŸ“Š **æ ·æœ¬ç»Ÿè®¡**: æ€»ç”Ÿæˆæ•°ã€æˆåŠŸæ•°ã€å¤±è´¥æ•°
- ğŸ“‹ **å¤±è´¥åŸå› **: è¯¦ç»†çš„å¤±è´¥åŸå› åˆ†ç±»ç»Ÿè®¡
- ğŸ† **å¥–åŠ±åˆ†æ**: å¹³å‡åˆ†ã€æœ€é«˜åˆ†ã€æœ€ä½åˆ†
- ğŸ“ˆ **è¶‹åŠ¿åˆ†æ**: æ€§èƒ½å˜åŒ–è¶‹åŠ¿
- ğŸ“„ **æŠ¥å‘Šç”Ÿæˆ**: è‡ªåŠ¨ç”Ÿæˆåˆ†ææŠ¥å‘Š

## ğŸ“ æ•°æ®æ–‡ä»¶æ ¼å¼

### ç”Ÿæˆæ ·æœ¬æ–‡ä»¶ (`generations/*.json`)
```json
{
  "step": 123,
  "timestamp": "2024-12-16T21:30:45",
  "prompt": "è®¾è®¡ä¸€ä¸ª...",
  "generated_text": "module example...",
  "generation_time": 2.34,
  "token_count": 456,
  "raw_output": "..."
}
```

### å¤±è´¥æ ·æœ¬æ–‡ä»¶ (`failed_generations/*.json`)
```json
{
  "step": 123,
  "timestamp": "2024-12-16T21:30:45",
  "prompt": "è®¾è®¡ä¸€ä¸ª...",
  "generated_text": "module example...",
  "failure_reason": "compilation_error",
  "error_details": "é”™è¯¯è¯¦æƒ…...",
  "compilation_output": "ç¼–è¯‘è¾“å‡º..."
}
```

### æˆåŠŸæ ·æœ¬æ–‡ä»¶ (`successful_generations/*.json`)
```json
{
  "step": 123,
  "timestamp": "2024-12-16T21:30:45",
  "prompt": "è®¾è®¡ä¸€ä¸ª...",
  "generated_text": "module example...",
  "reward_score": 8.5,
  "test_results": {
    "passed": 7,
    "failed": 0,
    "total": 7
  },
  "quality_metrics": {
    "complexity": 0.8,
    "readability": 0.9
  }
}
```

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. DEBUGç›®å½•åˆ›å»ºå¤±è´¥
```bash
# æ£€æŸ¥æƒé™
ls -la ./model_parallel_only_outputs/
# æ‰‹åŠ¨åˆ›å»ºç›®å½•
mkdir -p ./model_parallel_only_outputs/debug_data
```

#### 2. ç›‘æ§è„šæœ¬æ— æ³•è¿è¡Œ
```bash
# æ·»åŠ æ‰§è¡Œæƒé™
chmod +x monitor_training.sh
chmod +x analyze_debug_data.py
```

#### 3. ç£ç›˜ç©ºé—´ä¸è¶³
```bash
# æ£€æŸ¥ç£ç›˜ä½¿ç”¨
df -h ./model_parallel_only_outputs/
# æ¸…ç†æ—§çš„DEBUGæ•°æ®
rm -rf ./model_parallel_only_outputs/debug_data/old_timestamp/
```

#### 4. GPUç›‘æ§å¤±è´¥
```bash
# æ£€æŸ¥nvidia-smiæ˜¯å¦å¯ç”¨
nvidia-smi
# æ£€æŸ¥GPUç›‘æ§è¿›ç¨‹
ps aux | grep gpu_monitor
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. æ ¹æ®DEBUGæ•°æ®è°ƒæ•´å‚æ•°
- **å¤±è´¥ç‡é«˜**: é™ä½å­¦ä¹ ç‡ï¼Œå¢åŠ warmup
- **å¥–åŠ±åˆ†æ•°ä½**: æ£€æŸ¥å¥–åŠ±å‡½æ•°é…ç½®
- **ç”Ÿæˆè´¨é‡å·®**: è°ƒæ•´ç”Ÿæˆå‚æ•°ï¼ˆtemperature, top_pï¼‰

### 2. å­˜å‚¨ç®¡ç†
- **å®šæœŸæ¸…ç†**: åˆ é™¤æ—§çš„DEBUGæ•°æ®
- **å‹ç¼©å­˜å‚¨**: ä½¿ç”¨gzipå‹ç¼©JSONæ–‡ä»¶
- **é€‰æ‹©æ€§ä¿å­˜**: åªä¿å­˜å…³é”®æ­¥éª¤çš„DEBUGæ•°æ®

### 3. ç›‘æ§ä¼˜åŒ–
- **è°ƒæ•´åˆ·æ–°é—´éš”**: æ ¹æ®éœ€è¦è°ƒæ•´ç›‘æ§é¢‘ç‡
- **è¿‡æ»¤æ—¥å¿—**: åªæ˜¾ç¤ºå…³é”®ä¿¡æ¯
- **å¼‚æ­¥ç›‘æ§**: é¿å…å½±å“è®­ç»ƒæ€§èƒ½

## ğŸ¯ æœ€ä½³å®è·µ

1. **è®­ç»ƒå¼€å§‹å‰**
   - âœ… ç¡®ä¿æœ‰è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´ï¼ˆå»ºè®®è‡³å°‘50GBï¼‰
   - âœ… æ£€æŸ¥æ‰€æœ‰è„šæœ¬çš„æ‰§è¡Œæƒé™
   - âœ… éªŒè¯GPUçŠ¶æ€æ­£å¸¸

2. **è®­ç»ƒè¿‡ç¨‹ä¸­**
   - âœ… å®šæœŸæŸ¥çœ‹ç›‘æ§ç•Œé¢
   - âœ… æ£€æŸ¥DEBUGæ•°æ®æ˜¯å¦æ­£å¸¸ç”Ÿæˆ
   - âœ… å…³æ³¨GPUåˆ©ç”¨ç‡å’Œå†…å­˜ä½¿ç”¨

3. **è®­ç»ƒç»“æŸå**
   - âœ… è¿è¡Œæ•°æ®åˆ†æè„šæœ¬
   - âœ… æŸ¥çœ‹è®­ç»ƒæ‘˜è¦æŠ¥å‘Š
   - âœ… å¤‡ä»½é‡è¦çš„DEBUGæ•°æ®

## ğŸ“ æ”¯æŒä¸åé¦ˆ

å¦‚æœæ‚¨åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜æˆ–æœ‰æ”¹è¿›å»ºè®®ï¼Œè¯·ï¼š
1. æŸ¥çœ‹è®­ç»ƒæ—¥å¿—æ–‡ä»¶è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯
2. è¿è¡Œåˆ†æè„šæœ¬æŸ¥çœ‹æ•°æ®ç»Ÿè®¡
3. æ£€æŸ¥GPUç›‘æ§æ—¥å¿—ç¡®è®¤ç¡¬ä»¶çŠ¶æ€

---

**æ³¨æ„**: DEBUGæ¨¡å¼ä¼šæ˜¾è‘—å¢åŠ ç£ç›˜ä½¿ç”¨é‡å’Œè®­ç»ƒæ—¶é—´ï¼Œå»ºè®®åœ¨åˆ†æé—®é¢˜æ—¶å¯ç”¨ï¼Œæ­£å¸¸è®­ç»ƒæ—¶å¯ä»¥å…³é—­éƒ¨åˆ†DEBUGåŠŸèƒ½ã€‚ 